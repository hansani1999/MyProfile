<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport">
    <link href="assets/bootstrap/css/bootstrap.min.css" rel="stylesheet">
    <link href="assets/css/fonts/css/all.css" rel="stylesheet">
    <title>Home</title>
</head>
<body class="bg-light">
<nav class="navbar navbar-expand-lg navbar-dark bg-primary container-fluid me-0">
    <div class="container-fluid">
        <img alt="" height="80px" src="assets/images/cart.png">
        <div class="text-center me-5 text-white fs-2 fw-bold">Samanthas POS</div>
        <button aria-controls="navbarNavDropdown" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler"
                data-bs-target="#navbarNavDropdown" data-bs-toggle="collapse" type="button">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNavDropdown">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a aria-current="page" class="nav-link" href="#" id="navHome">Home</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="navOrders">Orders</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="navCustomer">Customers</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="#" id="navItem">Items</a>
                </li>
            </ul>
            <div class="d-flex">
                <div class="text-center text-white fs-6 "><a class="navbar-brand" href="#"><i
                        class="fas fa-user-plus p-1"></i>Sign up</a></div>
                <div class="text-center text-white fs-6 "><a class="navbar-brand" href="#"><i
                        class="fas fa-power-off p-1"></i>Log out</a></div>
            </div>
        </div>
    </div>
</nav>
<main class="justify-content-center container">
    <!--Home-->
    <section class="home ms-3">
        <section class="row bg-white p-1 me-0 mt-0">
            <section class="col-12 col-md-3 col-l-3 col-xl-3 mb-2 bg-primary bg-opacity-10 rounded-2 p-3 "><h1
                    class="fs-1 fw-bold text-center mt-5">Explore Best Buying Experiences...!</h1></section>
            <section class="col-12 col-md-9 col-l-6 col-xl-9 mb-2 bg-primary bg-opacity-25 rounded-2 p-0 ">
                <div class="carousel slide" data-bs-ride="carousel" id="carouselExampleCaptions">
                    <div class="carousel-indicators">
                        <button aria-current="true" aria-label="Slide 1" class="active"
                                data-bs-slide-to="0" data-bs-target="#carouselExampleCaptions" type="button"></button>
                        <button aria-label="Slide 2" data-bs-slide-to="1" data-bs-target="#carouselExampleCaptions"
                                type="button"></button>
                        <button aria-label="Slide 3" data-bs-slide-to="2" data-bs-target="#carouselExampleCaptions"
                                type="button"></button>
                        <button aria-label="Slide 4" data-bs-slide-to="3" data-bs-target="#carouselExampleCaptions"
                                type="button"></button>
                    </div>
                    <div class="carousel-inner ">

                        <div class="carousel-item">
                            <img alt="..." class="d-block w-100" src="assets/images/fv.jpg">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Fresh Fruits and Vegetables</h5>
                                <p>Explore fresh fruits and vegetables ever with us</p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img alt="..." class="d-block w-100" src="assets/images/diary.jpg">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Best Diary Products, Bakery, Seafood and Meat</h5>
                                <p>Best choice for healthy and safe food items</p>
                            </div>
                        </div>
                        <div class="carousel-item">
                            <img alt="..." class="d-block w-100" src="assets/images/cashi.jpg">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Excellent Customer Service</h5>
                                <p>Experience the best service & Customer care from our staff</p>
                            </div>
                        </div>
                        <div class="carousel-item active">
                            <img alt="..." class="d-block w-100" src="assets/images/discount.jpg">
                            <div class="carousel-caption d-none d-md-block">
                                <h5>Discount & Offers</h5>
                                <p>Experience special offers and discounts for your valuable purchase</p>
                            </div>
                        </div>
                    </div>
                    <button class="carousel-control-prev" data-bs-slide="prev" data-bs-target="#carouselExampleCaptions"
                            type="button">
                        <span aria-hidden="true" class="carousel-control-prev-icon"></span>
                        <span class="visually-hidden">Previous</span>
                    </button>
                    <button class="carousel-control-next" data-bs-slide="next" data-bs-target="#carouselExampleCaptions"
                            type="button">
                        <span aria-hidden="true" class="carousel-control-next-icon"></span>
                        <span class="visually-hidden">Next</span>
                    </button>
                </div>
            </section>
            <section class="col-12 col-md col-l-3 col-xl mb-2 bg-primary bg-opacity-25 rounded-2 p-1">
                <section class="row p-3 fs-2">
                    <div class="col bg-warning rounded-2 text-center p-3 ms-2 mb-2">
                        <i class="fas fa-shopping-cart p-3"></i>Orders
                        <div class="fs-1">200</div>
                    </div>
                    <div class="col bg-success text-white text-center ms-2 p-3 rounded-2 mb-2">
                        <i class="fas fa-users p-3"></i>Customers
                        <div class="fs-1">100</div>
                    </div>
                    <div class="col bg-danger text-white rounded-2 ms-2 text-center p-3 mb-2">
                        <i class="fas fa-box-open p-3"></i>Items
                        <div class="fs-1">900</div>
                    </div>
                </section>
            </section>
        </section>
    </section>

    <!--Orders-->
    <section class="orders">
        <section class="bg-white shadow rounded-2 mb-3  mt-4 p-3 fs-1 text-center text-primary"><i
                class="fas fa-hand-holding-usd p-2"></i>Sales Point
        </section>
        <section class="row bg-white p-3 me-0 ms-0 mt-0">
            <section class="col-12 col-md col-l col-xl mb-2 bg-primary bg-opacity-10 rounded-2 p-0 me-2">
                <div class="fs-6 text-center bg-primary bg-opacity-25 shadow p-2 ">Order Details</div>
                <div class="row p-4">
                    <div class="col mb-4">
                        <label class="form-label" for="oid">Order Id</label>
                        <input aria-label="Order ID" class="form-control" id="oid" placeholder="OID-001" type="text">
                        <p><small class="text-danger" id="errTxtOid"></small></p>
                    </div>
                    <div class="col mb-3">
                        <label class="form-label" for="txtDate">Order Date</label>
                        <input  aria-label="Last name" class="form-control" id="txtDate" type="date">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="txtCid">Customer Id</label>
                        <!--<input class="form-control" id="txtCid" placeholder="C001" type="text">-->
                        <select class="form-select" id="txtCid">
                            <!--<option selected></option>-->
                            <!--<option>Kamal</option>
                            <option>Nimal</option>
                            <option>Sunimal</option>-->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="name">Name</label>
                        <input class="form-control txtODInput" id="name" placeholder="Kamal" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="address">Address</label>
                        <input class="form-control txtODInput" id="address" placeholder="Galle" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="salary">Salary</label>
                        <input class="form-control txtODInput" id="salary" placeholder="50000.00" type="text">
                    </div>
                </div>
            </section>
            <section class="col-12 col-md col-l col-xl mb-2 bg-primary bg-opacity-25 rounded-2 p-0 me-2">
                <div class="fs-6 text-center bg-primary bg-opacity-50 shadow text-white p-2 ">Item Details</div>
                <div class="row p-4">
                    <div class="col mb-3">
                        <label class="form-label" for="code">Item Code</label>
                        <!--<input aria-label="Order ID" class="form-control" id="code" placeholder="I-001" type="text">-->
                        <select class="form-select" id="code">
                            <option selected>--Select item--</option>
                            <!--<option>I1</option>
                            <option>I2</option>
                            <option>I3</option>-->
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="itemName">Description</label>
                        <input class="form-control txtODItemInput" id="itemName" placeholder="Item1" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="txtPrice">Price</label>
                        <input class="form-control txtODInput" id="txtPrice" placeholder="100.00" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="qty">Quantity</label>
                        <input class="form-control txtODInput" id="qty" placeholder="10" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="oQty">Order qty</label>
                        <input class="form-control txtODInput" id="oQty" placeholder="5" type="text">
                    </div>
                    <div class="col align-content-stretch">
                        <button id="btnAddItem" class="btn btn-primary" type="submit">Add Item</button>
                        <!--<button id="btnClear" class="btn btn-dark" type="submit">Clear</button>-->
                    </div>
                </div>
            </section>
            <section class="col-12 col-md-12 col-l col-xl mb-2 bg-light rounded-2 p-0 me-2">
                <div class="fs-6 text-center text-white bg-info bg-opacity-50 shadow p-2 ">Payment</div>
                <div class="row p-4">
                    <div class="col mb-3 fs-2 text-center">
                        <label class="form-label text-info" for="code">Total :</label>
                        <label id="lblTotal" class="form-label text-info ms-5" for="code"></label>
                    </div>
                    <div class="mb-3">
                        <div class="col mb-3 fs-2 text-center">
                            <label class="form-label text-danger" for="code">SubTotal :</label>
                            <label id="lblSubTotal" class="form-label text-danger ms-5" for="code"></label>
                        </div>
                    </div>
                    <div class="col mb-4">
                        <label class="form-label" for="txtCash">Cash</label>
                        <input aria-label="Order ID" class="form-control" id="txtCash" type="text">
                    </div>
                    <div class="col mb-3">
                        <label class="form-label" for="txtDiscount">Discount</label>
                        <input aria-label="Last name" class="form-control" id="txtDiscount" type="text">
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="txtBalance">Balance</label>
                        <input class="form-control" id="txtBalance" placeholder="5" type="text">
                    </div>
                    <div class="col-auto">
                        <button id="btnPurchase" class="btn btn-success">Purchase</button>
                    </div>
                </div>
            </section>
            <section class="container-fluid p-3 ">
                <table id="tblCart" class="table table-sm table-hover">
                    <thead class="bg-danger bg-opacity-50">
                    <tr>
                        <th scope="col">Code</th>
                        <th scope="col">Name</th>
                        <th scope="col">Price</th>
                        <th scope="col">Qty</th>
                        <th scope="col">Total(LKR)</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>
        </section>

        <section class="container-fluid p-3">
            <p>
                <button aria-controls="collapseExample" aria-expanded="false" class="btn btn-secondary"
                        data-bs-target="#collapseExample" data-bs-toggle="collapse" type="button">
                    View All Orders
                </button>
            </p>
            <div class="collapse" id="collapseExample">
                <div class="card card-body">
                    <div class="container mb-2">
                        <label class="form-label text-secondary" for="txtSearch"><i class="fas fa-search p-2"></i>Search
                            Order</label>
                        <input class="form-control" id="txtSearch" placeholder="Enter Order ID" type="text">
                    </div>
                    <table id="tblOrder" class="table table-sm table-hover">
                        <thead class="bg-success bg-opacity-50">
                        <tr>
                            <th scope="col">OID</th>
                            <th scope="col">Cust.Id</th>
                            <th scope="col">cost</th>
                            <th scope="col">Date</th>
                            <th scope="col">Edit</th>
                        </tr>
                        </thead>
                        <tbody>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>
    </section>

    <!--Customers-->
    <section class="customer">
        <section class="bg-primary bg-opacity-25 mt-4 row rounded-2 text-center">
            <h1 class="text-center"><i class="fas fa-users p-3"></i>Customers</h1>
        </section>
        <section class="bg-white mt-3 shadow rounded-2 row p-2 ">
            <section class="col-12 col-lg col-xl ms-0 me-1 bg-primary bg-opacity-10 rounded-2 p-0">
                <div class="fs-6 text-center bg-light shadow p-2 ">Search Customer</div>
                <div class="mt-5 row p-2">
                    <div class="col-12">
                        <!--<label for="inputCity" class="form-label"></label>-->
                        <input class="form-control" id="txtSearchCust" placeholder="Enter Customer ID eg: C00-001" type="text">
                    </div>
                    <div class="col-3 mt-3">
                        <button id="btnSearchCust" class="btn btn-primary" type="submit">Search</button>
                    </div>
                    <div class="col-9 mt-3">
                        <select class="form-select" id="satate">
                            <option selected>Name</option>
                            <option>Kamal</option>
                            <option>Nimal</option>
                            <option>Sunimal</option>
                        </select>
                    </div>
                </div>
                <section class="container mt-3 col-12 p-0">
                    <div class="d-flex justify-content-center">
                        <button id="btnDeleteCustomer" class="btn btn-danger me-2 mb-2" type="button">Delete</button>
                        <button class="btn btn-info me-2 mb-2" type="button">Details</button>
                        <button id="btnClearCus" class="btn btn-dark me-2 mb-2" type="button">Clear</button>
                    </div>
                </section>
            </section>
            <section class="col-12 col-lg col-xl ms-0 bg-light">
                <form>
                    <div class="mb-3">
                        <label class="form-label" for="cid">Customer Id</label>
                        <input class="form-control txtInput" id="cid" placeholder="C00-001" type="text">
                        <p><small id="errTxtCusId" class="text-danger"></small></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="newCustName">Name</label>
                        <input class="form-control txtInput" id="newCustName" placeholder="Kamal" type="text">
                        <p><small id="errTxtCusName" class="text-danger"></small></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="newCustAddress">Address</label>
                        <input class="form-control txtInput" id="newCustAddress" placeholder="Galle" type="text">
                        <p><small id="errTxtCusAddress" class="text-danger"></small></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="newCustSalary">Salary</label>
                        <input class="form-control txtInput" id="newCustSalary" placeholder="50000.00" type="text">
                        <p><small id="errTxtCusSalary" class="text-danger"></small></p>
                    </div>
                    <div class="d-flex justify-content-center p-3">
                        <button class="btn btn-success me-3 ps-4 pe-4" id="btnSaveCustomer" type="button">Save</button>
                        <button id="btnUpdate" class="btn btn-warning" type="button">Update</button>
                    </div>
                </form>

            </section>

            <section class="container-fluid row mt-4 ms-1 bg-light">
                <table id="tblCust" class="table table-sm table-hover col">
                    <thead class="bg-info bg-opacity-25">
                    <tr>
                        <th scope="col">ID</th>
                        <th scope="col">Name</th>
                        <th scope="col">Address</th>
                        <th scope="col">Salary</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>
        </section>
    </section>

    <!--Items-->
    <section class="item">
        <section class="bg-primary bg-opacity-50 mt-4 rounded-2 row">
            <h1 class="text-center"><i class="fas fa-cubes p-3"></i>Items</h1>
        </section>
        <section class="bg-white mt-3 shadow rounded-2 mb-3 row p-2 ">
            <section class="col-12 col-lg col-xl ms-0 me-1 mb-2 bg-primary bg-opacity-10 rounded-2 p-0 ">
                <div class="fs-6 text-center bg-primary bg-opacity-10 shadow p-2 row-12">Search Item</div>
                <div class="mt-5 row p-2">
                    <div class="col-12">
                        <!--<label for="inputCity" class="form-label"></label>-->
                        <input class="form-control" id="txtSearchItem" placeholder="Enter ID eg: I00-001" type="text">
                    </div>
                    <div class="col-3 mt-3">
                        <button id="btnSearchItem" class="btn btn-primary" style="width: 100%" type="submit">Search</button>
                    </div>
                    <div class="col-9 mt-3">
                        <select class="form-select" id="inputState">
                            <option selected>Item Name</option>
                            <option>Item1</option>
                            <option>Item2</option>
                            <option>Item3</option>
                        </select>
                    </div>
                </div>
                <section class="container mt-3 p-0">
                    <div class="d-flex justify-content-center">
                        <button id="btnDeleteItem" class="btn btn-danger me-2 mb-2" type="button">Delete</button>
                        <button class="btn btn-info me-2 mb-2" type="button">Details</button>
                        <button id="btnClearItemForm" class="btn btn-dark me-2 mb-2" type="button">Clear</button>
                    </div>
                </section>
            </section>
            <section class="col-12 col-lg col-xl ms-0 me-1 mb-2 bg-primary bg-opacity-25">
                <form>
                    <div class="mb-3">
                        <label class="form-label" for="itemCode">Item Code</label>
                        <input class="form-control txtItemInput" id="itemCode" placeholder="I00-001" type="text">
                        <p><small id="errItemCode" class="text-danger"></small></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="newItemName">Description</label>
                        <input class="form-control txtItemInput" id="newItemName" placeholder="Item1" type="text">
                        <p><small id="errItemName" class="text-danger"></small></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="price">Price</label>
                        <input class="form-control txtItemInput" id="price" placeholder="100.00" type="text">
                        <p><small id="errPrice" class="text-danger"></small></p>
                    </div>
                    <div class="mb-3">
                        <label class="form-label" for="quantity">Quantity</label>
                        <input class="form-control txtItemInput" id="quantity" placeholder="100" type="text">
                        <p><small id="errQty" class="text-danger"></small></p>
                    </div>
                    <div class="d-flex justify-content-center p-3">
                        <button class="btn btn-success me-3 ps-4 pe-4" id="btnSaveItem" type="button">Save</button>
                        <button id="btnUpdateItem" class="btn btn-warning" type="button">Update</button>
                    </div>
                </form>
            </section>
            <section class="container mt-4 bg-light">
                <table id="tblItem" class="table table-sm table-hover">
                    <thead class="bg-danger bg-opacity-50">
                    <tr>
                        <th scope="col">Item Code</th>
                        <th scope="col">Name</th>
                        <th scope="col">Price(LKR.)</th>
                        <th scope="col">Qty</th>
                    </tr>
                    </thead>
                    <tbody></tbody>
                </table>
            </section>
        </section>
    </section>
</main>
<script src="assets/JQuery/jquery-3.6.0.min.js"></script>
<script src="assets/bootstrap/js/bootstrap.min.js"></script>
<script>
    /*Initial state*/
    $(".orders").css('display', 'none');
    $(".customer").css('display', 'none');
    $(".item").css('display', 'none');
    $(".home").css('display', 'block');

    /*navigation events*/
    $("#navHome").click(function () {
        $(".orders").css('display', 'none');
        $(".customer").css('display', 'none');
        $(".item").css('display', 'none');
        $(".home").css('display', 'block');
    });

    $("#navOrders").click(function () {
        $(".orders").css('display', 'block');
        $(".customer").css('display', 'none');
        $(".item").css('display', 'none');
        $(".home").css('display', 'none');
    });

    $("#navCustomer").click(function () {
        $(".orders").css('display', 'none');
        $(".customer").css('display', 'block');
        $(".item").css('display', 'none');
        $(".home").css('display', 'none');
    });

    $("#navItem").click(function () {
        $(".orders").css('display', 'none');
        $(".customer").css('display', 'none');
        $(".item").css('display', 'block');
        $(".home").css('display', 'none');
    });

    /*Customer starts*/
    /*Save Customer*/
    $("#btnSaveCustomer").prop('disabled',true);
    $("#btnSaveCustomer").click(function () {
        $("#tblCust>tbody>tr").off("click");

        let cusId= $("#cid").val();
        let cusName = $("#newCustName").val();
        let cusAddress = $("#newCustAddress").val();
        let cusSalary = $("#newCustSalary").val();

        var customerDTO = new CustomerDTO(cusId,cusName,cusAddress,cusSalary);

        let response = confirm("Are you sure you want to Add this Customer?");
        if (response){
            saveCustomer(customerDTO);
            clearCusForm();
            clearTable();
            loadAllCustomers();
            bindTableEvents();
            loadCustIds();
        }
    });


    /*Customer Update Starts*/
    $("#btnUpdate").on('click',function () {
        let cusId= $("#cid").val();
        let cusName = $("#newCustName").val();
        let cusAddress = $("#newCustAddress").val();
        let cusSalary = $("#newCustSalary").val();

        var updatedCustomerDTO = new CustomerDTO(cusId,cusName,cusAddress,cusSalary);
        var response = confirm("Are you sure you want to Update this Customer?");

        if (response){
            updateCustomer(updatedCustomerDTO);
            clearCusForm();
            clearTable();
            loadAllCustomers();
            bindTableEvents();
            loadCustIds();
        }
    });
    /*Customer Update Ends*/

    /*Customer Search Starts*/
    $("#btnSearchCust").click(function () {
        var searchId = $("#txtSearchCust").val();

        var response = searchCustomer(searchId);

        if (response){
            $("#cid").val(response.getCustomerId());
            $("#newCustName").val(response.getCustomerName());
            $("#newCustAddress").val(response.getAddress());
            $("#newCustSalary").val(response.getSalary());
        }else {
            alert("Customer Not Found");
        }
    });
    /*Customer Search Ends*/

    $("#btnClearCus").click(function () {
        clearCusForm();
    });

    /*customer form key events starts*/
    var regCusId = /^(C00-)[0-9]{3,4}$/;
    var regCusName = /^[A-z ]{3,20}$/;
    var regAddress = /^[A-z0-9/ ]{6,30}$/;
    var regSalary =  /^[1-9][0-9]*([.][0-9]{2})?$/;

    $(".txtInput").on('keydown',function (e) {
        if(e.key=="Tab"){
            e.preventDefault();
        }
    });

    $(".txtItemInput").on('keydown',function (e) {
        if(e.key=="Tab"){
            e.preventDefault();
        }
    });

    $("#btnSaveCustomer").prop('disabled',true);
    $(".txtInput").keyup(function (event) {
        if (event.key=="Enter"){
            if(regCusId.test($("#cid").val())){
                $("#newCustName").focus();
                if (regCusName.test($("#newCustName").val())){
                    $("#newCustAddress").focus();
                    if (regAddress.test($("#newCustAddress").val())){
                        $("#newCustSalary").focus();
                        if (regSalary.test($("#newCustSalary").val())){
                            $("#btnSaveCustomer").focus();
                        }else{
                            $("#newCustSalary").focus();
                        }
                    }else {
                        $("#newCustAddress").focus();
                    }
                }else{
                    $("#newCustName").focus();
                }
            }else {
                $("#cid").focus();
            }
        }

        if(regCusId.test($("#cid").val())){
            $("#cid").css('border','2px solid green');
            $("#errTxtCusId").text("");

            if (regCusName.test($("#newCustName").val())){
                $("#newCustName").css('border','2px solid green');
                $("#errTxtCusName").text("");

                if (regAddress.test($("#newCustAddress").val())){
                    $("#newCustAddress").css('border','2px solid green');
                    $("#errTxtCusAddress").text("");

                    if (regSalary.test($("#newCustSalary").val())){
                        $("#newCustSalary").css('border','2px solid green');
                        $("#errTxtCusSalary").text("");
                        $("#btnSaveCustomer").prop('disabled',false);
                    }else {
                        $("#newCustSalary").css('border','2px solid red');
                        $("#errTxtCusSalary").text("Incorrect format! : 10000.00");
                        $("#btnSaveCustomer").prop('disabled',true);
                    }
                }else {
                    $("#newCustAddress").css('border','2px solid red');
                    $("#errTxtCusAddress").text("Incorrect format! : Colombo 07");
                    $("#btnSaveCustomer").prop('disabled',true);
                }
            }else {
                $("#newCustName").css('border','2px solid red');
                $("#errTxtCusName").text("Incorrect format! : John Legend");
                $("#btnSaveCustomer").prop('disabled',true);
            }
        }else {
            $("#cid").css('border','2px solid red');
            $("#errTxtCusId").text("Incorrect format! : C00-001");
            $("#btnSaveCustomer").prop('disabled',true);
        }
    });
    /*customer form key events ends*/
    /*Customer ends*/

    /*Item starts*/
    /*Save Item*/
    $("#btnSaveItem").click(function () {
        let itemCode = $("#itemCode").val();
        let description = $("#newItemName").val();
        let itemPrice = $("#price").val();
        let quantity = $("#quantity").val();

        var itemDTO = new ItemDTO(itemCode,description,itemPrice,quantity);
        let response = confirm("Are you sure you want to Add this Item?");

        if (response){
            saveItem(itemDTO);
            clearItemForm();
            clearItemTable();
            loadAllItems();
            bindItemTableEvents();
            loadItemIds();
        }else {

        }
    });

    /*Item Update Starts*/
    $("#btnUpdateItem").click(function () {
        //alert("update item");
        let itemCode = $("#itemCode").val();
        let description = $("#newItemName").val();
        let itemPrice = $("#price").val();
        let quantity = $("#quantity").val();

        var updatedItem = new ItemDTO(itemCode,description,itemPrice,quantity);
        let response = confirm("Are you sure you want to update this Item?");

        if (response){
           updateItem(updatedItem);
           clearItemForm();
           clearItemTable();
           loadAllItems();
           bindItemTableEvents();
           loadItemIds();
        }else {

        }
    });
    /*Item Update Ends*/

    /*Item Search Starts*/
    $("#btnSearchItem").click(function () {
        let searchCode = $("#txtSearchItem").val();
        let searchResponse = searchItem(searchCode);

        if (searchResponse){
            $("#itemCode").val(searchResponse.getItemCode());
            $("#newItemName").val(searchResponse.getDescription());
            $("#price").val(searchResponse.getPrice());
            $("#quantity").val(searchResponse.getQty());
        }else{
            alert("No Items match your search");
        }
    });
    /*Item Search Ends*/

    $("#btnClearItemForm").click(function () {
        clearItemForm();
    });

    let regItemCode = /^(I00-)[0-9]{3,4}$/;
    let regItemName = /^[A-z ]{3,20}$/;
    let regPrice = /^[1-9][0-9]*([.][0-9]{2})?$/;
    let regQty = /^[1-9][0-9]*$/;

    $("#btnSaveItem").prop('disabled',true);
    $(".txtItemInput").keyup(function (event) {
        if(event.key=="Enter"){
            if(regItemCode.test($("#itemCode").val())){
                $("#newItemName").focus();
                if(regItemName.test($("#newItemName").val())){
                    $("#price").focus();
                    if(regPrice.test($("#price").val())){
                        $("#quantity").focus();
                        if(regQty.test($("#quantity").val())){
                            $("#btnSaveItem").focus();
                        }else {
                            $("#quantity").focus();
                        }
                    }else{
                        $("#price").focus();
                    }
                }else{
                    $("#newItemName").focus();
                }
            }else{
                $("#itemCode").focus();
            }
        }

        if(regItemCode.test($("#itemCode").val())){
            $("#itemCode").css('border','2px solid green');
            $("#errItemCode").text("");
            if(regItemName.test($("#newItemName").val())){
                $("#newItemName").css('border','2px solid green');
                $("#errItemName").text("");
                if(regPrice.test($("#price").val())){
                    $("#price").css('border','2px solid green');
                    $("#errPrice").text("");
                    if(regQty.test($("#quantity").val())){
                        $("#quantity").css('border','2px solid green');
                        $("#errQty").text("");
                        $("#btnSaveItem").prop('disabled',false);
                    }else {
                        $("#quantity").css('border','2px solid red');
                        $("#errQty").text("Incorrect Format! : 100");
                        $("#btnSaveItem").prop('disabled',true);
                    }
                }else{
                    $("#price").css('border','2px solid red');
                    $("#errPrice").text("Incorrect Format! : 100.00");
                    $("#btnSaveItem").prop('disabled',true);
                }
            }else{
                $("#newItemName").css('border','2px solid red');
                $("#errItemName").text("Incorrect Format! : Potatoes");
                $("#btnSaveItem").prop('disabled',true);
            }
        }else{
            $("#itemCode").css('border','2px solid red');
            $("#errItemCode").text("Incorrect Format! : I00-000");
            $("#btnSaveItem").prop('disabled',true);
        }
    });
    /*Item ends*/


    /*Order form key events start*/
    $("#btnAddItem").prop('disabled',true);
    $("#btnPurchase").prop('disabled',true);
    $(".txtODInput").keyup(function (event) {
        if(regCusName.test($("#name").val())){
            $("#name").css('border','2px solid green');
            //$("#errTxtCusId").text("");
            if(regAddress.test($("#address").val())){
                $("#address").css('border','2px solid green');
                if(regSalary.test($("#salary").val())){
                    $("#salary").css('border','2px solid green');
                    if(regItemName.test($("#itemName").val())){
                        $("#itemName").css('border','2px solid green');
                        $("#errItemCode").text("");
                        if(regPrice.test($("#txtPrice").val())){
                            $("#txtPrice").css('border','2px solid green');
                            $("#errItemCode").text("");
                            if (regQty.test($("#qty").val())){
                                $("#qty").css('border','2px solid green');
                                if (regQty.test($("#oQty").val()) && parseInt($("#oQty").val())<=parseInt($("#qty").val())){
                                    $("#oQty").css('border','2px solid green');
                                    $("#btnAddItem").prop('disabled',false);
                                    $("#btnPurchase").prop('disabled',false);
                                }else {
                                    $("#oQty").css('border','2px solid red');
                                    $("#btnPurchase").prop('disabled',true);
                                    $("#btnAddItem").prop('disabled',true);
                                }
                            }else {
                                $("#qty").css('border','2px solid red');
                                $("#btnPurchase").prop('disabled',true);
                                $("#btnAddItem").prop('disabled',true);
                            }
                        }else{
                            $("#txtPrice").css('border','2px solid red');
                            $("#btnPurchase").prop('disabled',true);
                            $("#btnAddItem").prop('disabled',true);
                        }
                    }else{
                        $("#itemName").css('border','2px solid red');
                        $("#btnPurchase").prop('disabled',true);
                        $("#btnAddItem").prop('disabled',true);
                    }
                }else {
                    $("#salary").css('border','2px solid red');
                    $("#btnPurchase").prop('disabled',true);
                    $("#btnAddItem").prop('disabled',true);
                }
            }else {
                $("#address").css('border','2px solid red');
                $("#btnPurchase").prop('disabled',true);
                $("#btnAddItem").prop('disabled',true);
            }
        }else {
            $("#name").css('border','2px solid red');
            $("#btnPurchase").prop('disabled',true);
            $("#btnAddItem").prop('disabled',true);
            //$("#errTxtCusId").text("Incorrect format! : C00-001");
        }
    });


    $("#txtCash").keyup(function (event){
        calcBalance();
        //$("#txtCash").css('border','2px solid red');
    });

    $("#txtDiscount").keyup(function (event){
        calcDiscount();
        //$("#txtCash").css('border','2px solid red');
    });

    function calcDiscount() {
        var cost = $("#lblTotal").text();
        var discount = parseInt($("#txtDiscount").val());
        var subTotal = cost.split("/")[0]-discount;
        if (!$("#txtDiscount").val()){
            $("#lblSubTotal").text(cost);
        }else {
            $("#lblSubTotal").text(subTotal+"/=");
        }
    }

    function calcBalance() {
        var balance = parseInt($("#txtCash").val())-parseInt($("#lblSubTotal").text());
        if(!$("#txtCash").val()){
            $("#txtBalance").val("");
        }else {
            $("#txtBalance").val(balance);
        }
    }
    /*$(".txtODItemInput").keyup(function (event) {
        if(regItemName.test($("#itemName").val())){
            $("#itemName").css('border','2px solid green');
            $("#errItemCode").text("");
            if(regPrice.test($("#txtPrice").val())){
                $("#txtPrice").css('border','2px solid green');
                $("#errItemCode").text("");
                if (regQty.test($("#qty").val())){
                    $("#qty").css('border','2px solid green');
                }else {
                    $("#qty").css('border','2px solid red');
                }
            }else{
                $("#txtPrice").css('border','2px solid red');
            }
        }else{
            $("#itemName").css('border','2px solid red');
        }
    });*/
    /*Order form key events end*/

    /*Add Item*/
    let total = 0;
    let newQty = 0;

    $("#btnAddItem").click(function () {
        $("#tblCart>tbody>tr").off();
        let itemCode = $("#code").val();
        let description = $("#itemName").val();
        let itemPrice = $("#txtPrice").val();
        let orderQty = $("#oQty").val();
        let itemTotal = itemPrice*orderQty;

        let oid = $("#oid").val();
        var cartItem = new CartItem(oid,itemCode,description,itemPrice,orderQty,itemTotal);
        console.log("OrderQty : "+orderQty);

        var response = ifExistsItem(itemCode);
        console.log(response);
        if (!response){
            addCartItem(cartItem);
            let row = `<tr class="bg-danger bg-opacity-10"><td>${itemCode}</td><td>${description}</td><td>${itemPrice}</td><td>${orderQty}</td><td>${itemTotal}</td></tr>`;
            $("#tblCart").append(row);
        }else{
            var oldQty = parseInt(response.getQty());
            var addedQty = parseInt(orderQty);
            newQty+=(oldQty+addedQty);
            response.setQty(newQty);
            response.setTotal(newQty*itemPrice);
            $("#tblCart>tbody>tr").empty();
            loadCartItems();
        }

        total+=itemTotal;


        $("#lblTotal").text(total+"/=");
        $("#lblSubTotal").text(total+"/=");

        $("#tblCart>tbody>tr").dblclick(function () {
            let selectedRow  = $(this);
            let deleteCode = $(this).children(":nth-child(1)").text();

            let response = confirm("Are you sure you want to Delete this from Cart?");
            if (response){
                var itemTot = $(this).children(":nth-child(5)").text();
                var oldTot = $("#lblTotal").text().split("/")[0];
                var newTot = oldTot-itemTot;
                total=newTot;
                newQty=0;
                console.log(newTot ,itemTot ,oldTot);
                $("#lblTotal").text(newTot+"/=");
                $("#lblSubTotal").text(newTot+"/=");
                removeCartItem(deleteCode);
                selectedRow.remove();
            }
        });
    });

    /*Add Order*/
    $("#btnPurchase").click(function () {
        let orderId = $("#oid").val();
        let orderDate = $("#txtDate").val();
        let cusId = $("#txtCid").val();
        let cost = $("#lblSubTotal").text();
        let discount = $("#txtDiscount").val();

        var orderDTO = new OrderDTO(orderId,cusId,cost,orderDate,discount);
        var orderDetailList = new Array();

        for (var cItem of cart){
            orderDetailList.push(
                new OrderDetail(cItem.getOrderId(), cItem.getItemCode(), cItem.getDescription(), cItem.getPrice(), cItem.getQty())
            );
            console.log("OrderQty : "+cItem.getQty());
        }

        let costValue = cost.split("/")[0];

        if (!$("#oid").val()){
            //$("#btnPurchase").off();
            $("#oid").css('border','2px solid red');
            $("#errTxtOid").text("*Required field!");
        }else if (parseInt($("#txtCash").val()) < parseInt($("#lblSubTotal").text()) || !$("#txtCash").val()){
            alert("Insufficient Cash! Please Check for cash");
        }else {
            $("#oid").css('border','2px solid green');
            $("#errTxtOid").text("");
            addOrder(orderDTO);
            addOrderDetail(orderDetailList);
            clearCart();
            clearForms();
            clearCartTable();
            total=0;
            newQty=0;
            let row = `<tr><td>${orderId}</td><td>${cusId}</td><td>${costValue}</td><td>${orderDate}</td><td><button class="btn p-1 btn-warning"><i class="fas fa-edit"></i></button><button class="btn p-1 ms-1 btn-danger"><i class="fas fa-trash-alt"></i></button></td></tr>`;
            $("#tblOrder").append(row);
            console.log(cart);
            console.log(orderDB);
            console.log(orderDetailDB);
            alert("Order Placed Successfully!");
        }
    });


    /*Search Order Starts*/
    $("#oid").keyup(function (event) {
        if(event.key=="Enter"){
            let searchId = $("#oid").val();
            var order = searchOrder(searchId);
            var list = searchOrderDetail(searchId);

            var cid = order.getCusId();

            var customer = searchCustomer(cid);

            $("#txtDate").text(order.getDate());
            $("#txtCid").val(customer.getCustomerId());
            $("#name").val(customer.getCustomerName());
            $("#address").val(customer.getAddress());
            $("#salary").val(customer.getSalary());
            var total = parseInt(order.getCost())+parseInt(order.getDiscount());
            $("#lblTotal").text(total+"/=");
            $("#lblSubTotal").text(order.getCost());

            if (list){
                for (var i of list){
                    var tot = parseInt(i.getPrice())*parseInt(i.getOrderQty());
                    //console.log(i.getItemCode(),i.getDescription(),i.getPrice(),i.getOrderQty());
                    let row = `<tr><td>${i.getItemCode()}</td><td>${i.getDescription()}</td><td>${i.getPrice()}</td><td>${i.getOrderQty()}</td><td>${tot}</td></tr>`;
                    $("#tblCart").append(row);
                }
            }else {
                alert("Not found");
            }

        }
    });
    /*Search Order Ends*/

    function clearCart() {
        while(cart.length>0){
            cart.pop();
            console.log(cart.length);
        }
        //return cart;
    }

</script>
<script src="db/DB.js"></script>
<script src="controller/CustomerController.js"></script>
<script src="controller/ItemController.js"></script>
<script src="controller/OrderController.js"></script>
<script src="controller/OrderDetailController.js"></script>
<script src="model/Item.js"></script>
<script src="model/Customer.js"></script>
<script src="model/CartItem.js"></script>
<script src="model/Order.js"></script>
<script src="model/OrderDetail.js"></script>
</body>
</html>